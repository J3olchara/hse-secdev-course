# NFR.md — Требования безопасности (Security NFR)

> **Дата:** 2025-01-15
> **Версия:** 1.0
> **Статус:** В разработке

| ID     | Название | Описание | Метрика/Порог | Проверка (чем/где) | Компонент | Приоритет |
|--------|----------|----------|---------------|--------------------|-----------|-----------|
| **NFR-01** | **Хранение паролей** | Хэширование паролей только с использованием Argon2id с параметрами безопасности | t=3, m=256MB, p=1 | Конфиг + unit-тест | auth | High |
| **NFR-02** | **Ошибки в формате RFC7807** | Все ошибки API должны быть в формате RFC7807 с маскировкой PII и correlation_id | 100% endpoint'ов | Контракт-тесты + e2e | api | High |
| **NFR-03** | **Порог p95 /auth/login** | p95 время ответа ≤ 300 мс при нагрузке 50 RPS на stage | p95 ≤ 300 мс @ 50 RPS | Нагрузочный тест | auth | High |
| **NFR-04** | **Уязвимости зависимостей** | High/Critical уязвимости в зависимостях должны быть устранены в течение 7 дней | ≤ 7 дней до устранения | CI-отчёт SCA/SBOM | build | High |
| **NFR-05** | **Ротация секретов** | Регулярная ротация JWT секретов и других чувствительных данных | Раз в 30 дней | Vault/KMS политика + журнал | platform | Medium |
| **NFR-06** | **Rate limiting аутентификации** | Защита от брутфорс атак на эндпоинты аутентификации | ≤ 5 попыток/мин/IP | Интеграционные тесты | auth | High |
| **NFR-07** | **Шифрование данных в покое** | Шифрование чувствительных данных в базе данных | AES-256 для PII полей | Аудит безопасности БД | database | Medium |
| **NFR-08** | **Валидация входных данных** | Строгая валидация всех входных данных для предотвращения инъекций | 100% параметров валидированы | Unit-тесты валидации | api | High |
| **NFR-09** | **Безопасность заголовков** | Правильная настройка security headers (CSP, HSTS, etc.) | SecurityHeaders.com rating A+ | Penetration testing | api | Medium |
| **NFR-10** | **Аудит действий пользователей** | Логирование всех действий пользователей для compliance | Все CRUD операции логированы | Логи безопасности | api | Low |

## Дополнительная информация

### NFR-01 Хранение паролей
- **Реализация:** Использование `argon2-cffi` вместо `passlib` с pbkdf2
- **Параметры:** time_cost=3, memory_cost=256*1024, parallelism=1
- **Обоснование:** Argon2id обеспечивает лучшую защиту от GPU атак по сравнению с pbkdf2

### NFR-03 Производительность аутентификации
- **Метод измерения:** p95 перцентиль времени ответа
- **Окружение:** stage environment с нагрузкой 50 RPS
- **Инструменты:** Locust или Artillery для нагрузочного тестирования

### NFR-06 Rate limiting
- **Алгоритм:** Token bucket или sliding window
- **Правила:** 5 попыток на минуту с IP, блокировка на 15 минут после превышения
- **Исключения:** Trusted IPs (мониторинг, health checks)
